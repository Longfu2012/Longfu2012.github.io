<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Unity游戏音频资源提取-acb格式</title>
    <url>/2021/04/01/Unity%E6%B8%B8%E6%88%8F%E9%9F%B3%E9%A2%91%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96-acb%E6%A0%BC%E5%BC%8F/</url>
    <content><![CDATA[<h4 id="游戏音频文件"><a href="#游戏音频文件" class="headerlink" title="游戏音频文件"></a>游戏音频文件</h4><p>在一个Unity游戏中，发现音频文件在平时的放置位置没有找打，因为有需要参考与借鉴思路的需求，所以希望提取音频文件。在游戏包找了一圈后，发现后缀acb的文件大小和命名比较可以，所以先弄开看看，位置放在assets下面的任意可能一个文件夹里面，如下类似：</p>
<p><img src="/2021/04/01/Unity%E6%B8%B8%E6%88%8F%E9%9F%B3%E9%A2%91%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96-acb%E6%A0%BC%E5%BC%8F/1.png" alt="演示1"></p>
<h4 id="abc解压缩"><a href="#abc解压缩" class="headerlink" title="abc解压缩"></a>abc解压缩</h4><p>1.下载VGMToolbox工具对acb格式文件转成多个hca文件，下载地址如下：<br><a class="link" href="https://sourceforge.net/projects/vgmtoolbox/">VGMToolbox<i class="fas fa-external-link-alt"></i></a></p>
<p>2.由于是免安装了，所有下载后解压可以看到这exe，直接双击启动<br><img src="/2021/04/01/Unity%E6%B8%B8%E6%88%8F%E9%9F%B3%E9%A2%91%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96-acb%E6%A0%BC%E5%BC%8F/2.png" alt="演示2"></p>
<p>3.切换到对应的选项，然后把你需要转换的acb文件拖到这里<br><img src="/2021/04/01/Unity%E6%B8%B8%E6%88%8F%E9%9F%B3%E9%A2%91%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96-acb%E6%A0%BC%E5%BC%8F/3.png" alt="演示3"></p>
<h4 id="hca文件转化"><a href="#hca文件转化" class="headerlink" title="hca文件转化"></a>hca文件转化</h4><p>4.此时与acb格式文件同一个文件夹下面会生成一个文件夹，如图所示。（我拖动的是SFX.acb文件）<br><img src="/2021/04/01/Unity%E6%B8%B8%E6%88%8F%E9%9F%B3%E9%A2%91%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96-acb%E6%A0%BC%E5%BC%8F/4.png" alt="演示4"></p>
<p>5.下载hca.exe,然后解压放在hca文件相同文件夹内，对其进行hca格式转成wav格式的音频文件<br><a href="Unity%E6%B8%B8%E6%88%8F%E9%9F%B3%E9%A2%91%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96-acb%E6%A0%BC%E5%BC%8F/decode+hca.zip">hca及其批处理文件</a></p>
<p><img src="/2021/04/01/Unity%E6%B8%B8%E6%88%8F%E9%9F%B3%E9%A2%91%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96-acb%E6%A0%BC%E5%BC%8F/5.png" alt="演示5"></p>
<p><img src="/2021/04/01/Unity%E6%B8%B8%E6%88%8F%E9%9F%B3%E9%A2%91%E8%B5%84%E6%BA%90%E6%8F%90%E5%8F%96-acb%E6%A0%BC%E5%BC%8F/6.png" alt="演示6"></p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo-asset-image生成本地图片链接错误</title>
    <url>/2020/12/09/hexo-asset-image%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF/</url>
    <content><![CDATA[<h3 id="文章图片存放选型"><a href="#文章图片存放选型" class="headerlink" title="文章图片存放选型"></a>文章图片存放选型</h3><p>在安装好Hexo和把主题设置完成后，想在自己的文字里面添加一点图文说明，这样可以更好的表达文字旨意。那么如何让hexo生成的静态网页里面插入图片呢？<br>其实就是遵循markdown的语法可以有三种方式把图片插入到文章中:</p>
<ol>
<li> <strong>本地图片</strong><br>本地图片的插入，其实说白了，就是图片和我们生成的网页在同一个服务器下面（也就是说网页可以通过相对路径可以访问到图片）</li>
<li> <strong>网络图片</strong><br>网络插入的方式，你可以直接引用网络找到的图片（也就是一条网络链接，直接可以访问到图片），也可以自己绘制的图片通过图床的方式（也是生成一条可以访问的图片来访问这个图片）</li>
<li><strong>存到markdown文件中</strong><br>这种方式是紧紧的把图片和网页联系在一起，这个方式的好处就是不用担心链接失效的问题。</li>
</ol>
<p>这三种方式，经过我的一些考虑后，最后决定使用本地图片的方式来对文章的引用图片。下面给出我选择本地图片存储的理由和各种方式引用图片的步骤。</p>
<h4 id="为什么选择本地图片方式"><a href="#为什么选择本地图片方式" class="headerlink" title="为什么选择本地图片方式"></a>为什么选择本地图片方式</h4><p>主要还是因为节约成本和文章资源比较好整理，还有我怕麻烦，当我们看到一些比较旧的文章的时候，是不是有遇到过图片加载失败，有些说明没有图片的辅助让人很难理解作者想要表达的意思？对的，我就是想规避这类的问题，希望当我的服务器停止的时候，文章和图片共存亡，哈哈哈哈…..减少让人看了摸不着头脑的文章，提高文章的体验度。</p>
<h4 id="如何插入本地图片"><a href="#如何插入本地图片" class="headerlink" title="如何插入本地图片"></a>如何插入本地图片</h4><p>这个是这篇文章说的重点，也演示在这个过程中遇到的一些坑，和填坑的过程。</p>
<ul>
<li> <strong>安装hexo-asset-image插件</strong><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install https://github.com/CodeFalling/hexo-asset-image -- save</span><br></pre></td></tr></table></figure></li>
<li> <strong>配置 _config.yml</strong><br>在hexo初始化目录下找到 <code>_config.yml</code> 文件(注意是根目录的，不是在themes目录下)，打开并修改属性 <code>post_asset_folder: true</code> </li>
<li><strong>新建一篇文章</strong><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo n &quot;测试文章&quot;</span><br></pre></td></tr></table></figure>
执行上述命令后，你的 <code>xxx\source\_posts\</code> 文件夹下就生成了如下一个 <code>md</code> 文件和同名的文件夹<br><img src="/2020/12/09/hexo-asset-image%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF/2.png" alt="演示2"><br>这样你就可以通过把图片放在这个文件夹下面，然后通过<code>markdown</code>语法来愉快的插入图片了<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">![图片描述](文件夹的名称/带后缀的图片文件名)</span><br></pre></td></tr></table></figure>
<h4 id="小插曲"><a href="#小插曲" class="headerlink" title="小插曲"></a>小插曲</h4>凡事都不可能一帆风顺，除非你充了VIP。初次接触这个怎么可能没有遇到这个问题呢？一步三个坑，这个插曲就是一个坑…<br>经过一顿操作，hexo生成网页后，高兴的打开页面，发现<br><img src="/2020/12/09/hexo-asset-image%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF/3.png" alt="演示3"><br>小朋友心中产生了很多个问号,好奇的按下了F12查看图片链接<br><img src="/2020/12/09/hexo-asset-image%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF/4.png" alt="演示4"><br>我……..这……..，不对图片的链接不是由 <code>hexo-asset-image</code>生成的吗？<br>赶紧顺着<code>hexo-asset-image</code>的问题方向查找，果然…有bug..</li>
</ul>
<h5 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h5><p>找到<code>hexo-asset-image</code>的入口js文件<br><img src="/2020/12/09/hexo-asset-image%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF/5.png" alt="演示5"><br>把其替换如下js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">&#x27;cheerio&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPosition</span>(<span class="params">str, m, i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.split(m, i).join(m).length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> version = <span class="built_in">String</span>(hexo.version).split(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">hexo.extend.filter.register(<span class="string">&#x27;after_post_render&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> config = hexo.config;</span><br><span class="line">  <span class="keyword">if</span>(config.post_asset_folder)&#123;</span><br><span class="line">    	<span class="keyword">var</span> link = data.permalink;</span><br><span class="line">	<span class="keyword">if</span>(version.length &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">Number</span>(version[<span class="number">0</span>]) == <span class="number">3</span>)</span><br><span class="line">	   <span class="keyword">var</span> beginPos = getPosition(link, <span class="string">&#x27;/&#x27;</span>, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	   <span class="keyword">var</span> beginPos = getPosition(link, <span class="string">&#x27;/&#x27;</span>, <span class="number">3</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.</span></span><br><span class="line">	<span class="keyword">var</span> endPos = link.lastIndexOf(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>;</span><br><span class="line">    link = link.substring(beginPos, endPos);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> toprocess = [<span class="string">&#x27;excerpt&#x27;</span>, <span class="string">&#x27;more&#x27;</span>, <span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; toprocess.length; i++)&#123;</span><br><span class="line">      <span class="keyword">var</span> key = toprocess[i];</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">var</span> $ = cheerio.load(data[key], &#123;</span><br><span class="line">        ignoreWhitespace: <span class="literal">false</span>,</span><br><span class="line">        xmlMode: <span class="literal">false</span>,</span><br><span class="line">        lowerCaseTags: <span class="literal">false</span>,</span><br><span class="line">        decodeEntities: <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      $(<span class="string">&#x27;img&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ($(<span class="built_in">this</span>).attr(<span class="string">&#x27;src&#x27;</span>))&#123;</span><br><span class="line">			<span class="comment">// For windows style path, we replace &#x27;\&#x27; to &#x27;/&#x27;.</span></span><br><span class="line">			<span class="keyword">var</span> src = $(<span class="built_in">this</span>).attr(<span class="string">&#x27;src&#x27;</span>).replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">			<span class="keyword">if</span>(!<span class="regexp">/http[s]*.*|\/\/.*/</span>.test(src) &amp;&amp;</span><br><span class="line">			   !<span class="regexp">/^\s*\//</span>.test(src)) &#123;</span><br><span class="line">			  <span class="comment">// For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed.</span></span><br><span class="line">			  <span class="comment">// In addition, to support multi-level local directory.</span></span><br><span class="line">			  <span class="keyword">var</span> linkArray = link.split(<span class="string">&#x27;/&#x27;</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>)</span>&#123;</span><br><span class="line">				<span class="keyword">return</span> elem != <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">			  &#125;);</span><br><span class="line">			  <span class="keyword">var</span> srcArray = src.split(<span class="string">&#x27;/&#x27;</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>)</span>&#123;</span><br><span class="line">				<span class="keyword">return</span> elem != <span class="string">&#x27;&#x27;</span> &amp;&amp; elem != <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">			  &#125;);</span><br><span class="line">			  <span class="keyword">if</span>(srcArray.length &gt; <span class="number">1</span>)</span><br><span class="line">				srcArray.shift();</span><br><span class="line">			  src = srcArray.join(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">			  $(<span class="built_in">this</span>).attr(<span class="string">&#x27;src&#x27;</span>, config.root + link + src);</span><br><span class="line">			  <span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info(<span class="string">&quot;update link as:--&gt;&quot;</span>+config.root + link + src);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info(<span class="string">&quot;no src attr, skipped...&quot;</span>);</span><br><span class="line">			<span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info($(<span class="built_in">this</span>));</span><br><span class="line">		&#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      data[key] = $.html();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后执行hexo如下指令，就可以在本地愉快的预览到图片啦！</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo cl &amp;&amp; hexo g &amp;&amp; hexo s</span><br></pre></td></tr></table></figure>
<p>注意:清理缓存，生成网页，启动服务</p>
<h4 id="如何插入网络图片"><a href="#如何插入网络图片" class="headerlink" title="如何插入网络图片"></a>如何插入网络图片</h4><p>插入查网络图片就比较简单了，你只需要拿到一个你想要展示的图片的链接即可，那怎么拿呢？<br><a class="link" href="https://zhuanlan.zhihu.com/p/35270383">盘点国内免费好用的图床<i class="fas fa-external-link-alt"></i></a><br>可以通过这个选一个自己喜欢的，然后通过引用就可以把图片应用到文章里面来啦！</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">这里写图片的说明</span>](<span class="link">把这里换成图床给你的链接吧</span>)</span><br></pre></td></tr></table></figure>

<h4 id="如何插入图片到markdown到文章中"><a href="#如何插入图片到markdown到文章中" class="headerlink" title="如何插入图片到markdown到文章中"></a>如何插入图片到markdown到文章中</h4><p>这种方式比较合适对小图片的处理，原因是一些现成的图片转Base64的工具对大小有限制和网页加载的时候，图片太大，可能会对网页整体的加载速度产生影响。<br>这里推荐网址，用于把图片转换成Base64的工具。<br><a class="link" href="http://tool.chinaz.com/tools/imgtobase">图片转Base64数据<i class="fas fa-external-link-alt"></i></a><br>直接上传即可:<br><img src="/2020/12/09/hexo-asset-image%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF/1.png" alt="演示1"><br>然后通过markdown的语法引入到文章中</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">这里写图片的说明</span>](<span class="link">这里就把生成的Base64的数据直接粘贴上来</span>)</span><br></pre></td></tr></table></figure>
<p>虽然这么操作是可行的，但是你直接在文章中插入一大段的Base64数据肯定很难受，所有非要用Base64的方式插入图片的同学建议如下操作：</p>
<ol>
<li>将Base64数据放在文章的最后面并且对其命名一个id名字<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">[<span class="symbol">image_id</span>]:<span class="link">data:image/png;base64,iVBOR...(省略表示)</span></span><br></pre></td></tr></table></figure></li>
<li>在文章中引用这个id来插入图片<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">![<span class="string">这里写图片的说明</span>][<span class="symbol">image_id</span>]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="演示的配置信息"><a href="#演示的配置信息" class="headerlink" title="演示的配置信息"></a>演示的配置信息</h3><p><img src="/2020/12/09/hexo-asset-image%E7%94%9F%E6%88%90%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF/6.png" alt="演示6"></p>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>安咕噜的入栈开篇</title>
    <url>/2020/12/08/%E5%AE%89%E5%92%95%E5%99%9C%E7%9A%84%E5%85%A5%E6%A0%88%E5%BC%80%E7%AF%87/</url>
    <content><![CDATA[<h2 id="开篇原因"><a href="#开篇原因" class="headerlink" title="开篇原因"></a>开篇原因</h2><img src="/2020/12/08/%E5%AE%89%E5%92%95%E5%99%9C%E7%9A%84%E5%85%A5%E6%A0%88%E5%BC%80%E7%AF%87/1.png" class title="This is an image">
<h2 id="如何开篇"><a href="#如何开篇" class="headerlink" title="如何开篇"></a>如何开篇</h2><p><img src="/2020/12/08/%E5%AE%89%E5%92%95%E5%99%9C%E7%9A%84%E5%85%A5%E6%A0%88%E5%BC%80%E7%AF%87/2.png" alt="这个图片"></p>
<h2 id="开篇计划"><a href="#开篇计划" class="headerlink" title="开篇计划"></a>开篇计划</h2><h2 id="开篇结果"><a href="#开篇结果" class="headerlink" title="开篇结果"></a>开篇结果</h2>]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>xposed hook 多dex的apk</title>
    <url>/2021/04/17/xposed-hook-%E5%A4%9Adex%E7%9A%84apk/</url>
    <content><![CDATA[<h5 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h5><p>最近突然想hook一下东西，然后捡起xposed这个古老的东西就开始来hook它，然后突然给打脸了，仔细检查ClassName，methodName和parameter都毫无问题，为啥要打我脸？慢慢蹲下身子，沉思良久，自我检讨，xposed能有什么坏心思，问题肯定是出在自己身上，附上打脸现场日志。<br><img src="/2021/04/17/xposed-hook-%E5%A4%9Adex%E7%9A%84apk/1.png" alt="演示1"></p>
<h5 id="查因"><a href="#查因" class="headerlink" title="查因"></a>查因</h5><p>想要根除困扰自己问题的方法，只能从自身出发，马上检查自己打出来的包（这里以友盟SDK作为演示样例学习），好家伙，原来我要hook的类在第二个dex中（Adnroid打包机制，dex方法数超过邪恶的65535个方法就会按照一定的规律进行分包），问题找到了，也不能怪人家 <strong>XposedHelpers.findAndHookMethod</strong> 不行，不行的永远是自己，附上查因现场。<br><img src="/2021/04/17/xposed-hook-%E5%A4%9Adex%E7%9A%84apk/2.png" alt="演示2"></p>
<h5 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h5><p>既然是多dex导致的hook问题，那么只要找到那个dex再进行hook即可（这里的方式和动态加载dex hook的方式地方有点不一样）。这里必然想到Application入口，打开打开查看一下，必经之路好像是这个<br><img src="/2021/04/17/xposed-hook-%E5%A4%9Adex%E7%9A%84apk/3.png" alt="演示3"></p>
<p>那么代码就撸起来，这么写试试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//过滤一下不关注的包，排除影响</span></span><br><span class="line"> <span class="keyword">if</span>(!loadPackageParam.packageName.equals(<span class="string">&quot;yourPkgName&quot;</span>))</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">XposedHelpers.findAndHookMethod(Application.class, <span class="string">&quot;attach&quot;</span>,</span><br><span class="line">    Context.class, <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">            ClassLoader cl = ((Context) param.args[<span class="number">0</span>]).getClassLoader();</span><br><span class="line">            Class&lt;?&gt; hookclass = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            	<span class="comment">//查看dex有没有这个Class</span></span><br><span class="line">                hookclass = cl.loadClass(<span class="string">&quot;com.umeng.commonsdk.UMConfigure&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;load class error&quot;</span>+e);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//确定有这个Class再进行hook方法的操作</span></span><br><span class="line">            XposedBridge.log( <span class="string">&quot;load success&quot;</span>);</span><br><span class="line">            XposedHelpers.findAndHookMethod(hookclass, <span class="string">&quot;init&quot;</span>, Context.class,String.class,String.class,<span class="keyword">int</span>.class,String.class,</span><br><span class="line">                <span class="keyword">new</span> XC_MethodHook() &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        <span class="keyword">super</span>.beforeHookedMethod(param);</span><br><span class="line">                        XposedBridge.log( <span class="string">&quot;has Hooked!&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        <span class="comment">//打印一下形参</span></span><br><span class="line">                        XposedBridge.log(<span class="string">&quot;param.args[0] = &quot;</span>+param.args[<span class="number">0</span>]);</span><br><span class="line">                        XposedBridge.log(<span class="string">&quot;param.args[1] = &quot;</span>+param.args[<span class="number">1</span>]);</span><br><span class="line">                        XposedBridge.log(<span class="string">&quot;param.args[2] = &quot;</span>+param.args[<span class="number">2</span>]);</span><br><span class="line">                        XposedBridge.log(<span class="string">&quot;param.args[3] = &quot;</span>+param.args[<span class="number">3</span>]);</span><br><span class="line">                        XposedBridge.log(<span class="string">&quot;param.args[4] = &quot;</span>+param.args[<span class="number">4</span>]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>
<p>果然很顺利，成功hook到了多dex里面的方法了。<br><img src="/2021/04/17/xposed-hook-%E5%A4%9Adex%E7%9A%84apk/4.png" alt="演示4"></p>
]]></content>
      <categories>
        <category>xposed</category>
      </categories>
      <tags>
        <tag>xposed</tag>
      </tags>
  </entry>
  <entry>
    <title>游戏引擎学习之Unity3d&amp;Android通信</title>
    <url>/2021/04/22/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E5%AD%A6%E4%B9%A0%E4%B9%8BUnity3d-Android%E9%80%9A%E4%BF%A1/</url>
    <content><![CDATA[<h3 id="游戏引擎学习之Unity3d-amp-Android通信"><a href="#游戏引擎学习之Unity3d-amp-Android通信" class="headerlink" title="游戏引擎学习之Unity3d&amp;Android通信"></a>游戏引擎学习之Unity3d&amp;Android通信</h3><h4 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h4><p>Unity3d引擎是跨平台的，但是有时候需要Android平台的Sdk的时候，需要如何进行交互呢？Unity3d提供了一套相关套件，供我们指定平台Sdk和Unity3d（C#）进行通信。</p>
<h4 id="学习工具"><a href="#学习工具" class="headerlink" title="学习工具"></a>学习工具</h4><p>Unity3d引擎，Android Studio </p>
<h4 id="实施"><a href="#实施" class="headerlink" title="实施"></a>实施</h4><p>我们来测试Unity3d引擎提供的Android通信方案，分为两个步骤测试，新建两个工程，分别是Android工程和Unity3d工程（文后带有下载地址），然后测试各个调用方式</p>
<ul>
<li>工程构建</li>
</ul>
<p>1.Android工程构建<br>构建Android工程和Unity3d（C#）通信，这里使用的是Android Studio构建，步骤如下<br>1)平常新建Android工程一样，在Android Studio上新建一个简单的工程<br>2)寻找Unity3d引擎提供的Android编译包，比如，我使用的Unity3d是5.6.2f1版本的，我在安装路径下找到这个jar(我的是在win下的版本)</p>
<blockquote>
<p>你的安装目录\Unity\Editor\Data\PlaybackEngines\AndroidPlayer\Variations\mono\Release\Classes<br>3)将这个jar包复制一份，放到android工程的libs目录下，并在工程根的build.gradle文件中添加一句话</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">...</span><br><span class="line">provided files(&#39;libs&#x2F;unity3d.jar&#39;)</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时的jar我已经重命名为unity3d.jar<br>4)在Android工程的AndroidMainifest.xml文件中meta-data声明Unity3d的绘制Activity，我这里申明的是主Activity，如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">&lt;activity android:name&#x3D;&quot;.MainActivity&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name&#x3D;&quot;android.intent.action.MAIN&quot; &#x2F;&gt;</span><br><span class="line">                &lt;category android:name&#x3D;&quot;android.intent.category.LAUNCHER&quot; &#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;intent-filter&gt;</span><br><span class="line">            &lt;meta-data android:name&#x3D;&quot;unityplayer.UnityActivity&quot; android:value&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;activity&gt;</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>5)切换到4)步骤中对应的Activity的java文件中，让此Activity集成Unity3d提供的一个父类UnityPlayerActivity，如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class MainActivity extends UnityPlayerActivity &#123;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此，Android工程的准备工作就已经完成了</p>
<p>2.Unity3d工程构建</p>
<p>1)新建Scene和Script文件夹，存放场景和脚本<br>2)新建Plugins文件夹和在Plugins下再新建Android文件夹（划重点，名字不可变）</p>
<p>至此Unity3d工程已经构建完成</p>
<p>3.Android工程和Unity3d工程的联系建立<br>1)在Android的主Activity工程里面编写被Unity3d(C#)脚本调用的代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">public class MainActivity extends UnityPlayerActivity &#123;</span><br><span class="line"></span><br><span class="line">    private Context mContext;</span><br><span class="line">    private static final String ANDROID_STR &#x3D; &quot;Android Platform&quot;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        mContext &#x3D; this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void showToast()&#123;</span><br><span class="line">        Toast.makeText(mContext,ANDROID_STR,Toast.LENGTH_LONG).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void showToast(String unityStr)&#123;</span><br><span class="line">        Toast.makeText(mContext, TextUtils.isEmpty(unityStr) ? &quot;null&quot;:unityStr,Toast.LENGTH_LONG).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getAndroidStr()&#123;</span><br><span class="line">        return ANDROID_STR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>2)将Android工程的代码打成jar包<br>3)把Android工程打成的jar包，res目录，AndroidManifest.xml放在Unity3d插件目录下<br>4)现在就可以在Unity3d工程中愉快的调用Android插件提供的方法啦</p>
<ul>
<li>Unity3d ==&gt; Android</li>
</ul>
<p>初始化相关类,获得调用对象。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AndroidJavaClass androidjavaClass;</span><br><span class="line">AndroidJavaObject androidjavaObj;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Use this for initialization</span><br><span class="line">void Start () &#123;</span><br><span class="line">	androidjavaClass &#x3D; new AndroidJavaClass (&quot;com.unity3d.player.UnityPlayer&quot;);</span><br><span class="line">	androidjavaObj &#x3D; androidjavaClass.GetStatic&lt;AndroidJavaObject&gt; (&quot;currentActivity&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.无参调用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public void callToast()&#123;</span><br><span class="line">	if(null !&#x3D; androidjavaObj)&#123;</span><br><span class="line">		androidjavaObj.Call (&quot;showToast&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.有参调用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public void callToast2()&#123;</span><br><span class="line">	if(null !&#x3D; androidjavaObj)&#123;</span><br><span class="line">		androidjavaObj.Call (&quot;showToast&quot;,&quot;unity3d Str&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.有返回值</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public void callAndroidStr()&#123;</span><br><span class="line">	if(null !&#x3D; androidjavaObj)&#123;</span><br><span class="line">		string rlt &#x3D; androidjavaObj.Call&lt;string&gt; (&quot;getAndroidStr&quot;);</span><br><span class="line">		gameObject.GetComponentInChildren&lt;Text&gt;().text &#x3D; rlt;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Android ==&gt; Unity3d<br>Android端调用Unity3d提供的jar包，里面有一个方法<br>UnityPlayer.UnitySendMessage(String,String,String)<br>三个参数的含义分别是:</li>
<li>1、挂载脚本的对象（此脚本定义了需要调用的方法）*</li>
<li>2、挂载脚本里需要调用的方法名字*</li>
<li>3、需要传递给调用方法的参数字符串*</li>
</ul>
<p>1.无参调用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public void ChangeObj1()&#123;</span><br><span class="line">		gameObject.GetComponentInChildren&lt;Text&gt;().text &#x3D; &quot;android调用 无参方法&quot;;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>2.有参调用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public void ChangeObj2(string str)&#123;</span><br><span class="line">		gameObject.GetComponentInChildren&lt;Text&gt;().text &#x3D; &quot;android调用 有参方法 参数:&quot; + ((str &#x3D;&#x3D; null ) ? &quot;get null ?&quot;:str);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>注意：为什么要把方法名写的不一样，测试结果显示，若方法名一样，Android端调用Unity端时，只能调用到无参的那个方法。<br>3.有返回值</p>
<p>UnitySendMessage方法不提供返回值</p>
<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><p>1.Android插件的AndroidMainifest.xml的包名最好和Unity3d设置的包名一致<br>2.unity3d工程的Android apk导出设置需要和插件的AndroidMainifest.xml目标sdk版本一致，不然会导致报错,最好配置都一致。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Warning: [Temp\StagingArea\AndroidManifest-main.xml:12, E:\workspace_u3d\Unity3dDemo\Temp\StagingArea\android-libraries\UnityTest-release\AndroidManifest.xml:3] Main manifest has &lt;uses-sdk android:targetSdkVersion&#x3D;&#39;24&#39;&gt; but library uses targetSdkVersion&#x3D;&#39;26&#39;</span><br></pre></td></tr></table></figure>
<p>3.若Android调用Unity3d（C#）方法中有重载方法，只会调用无参的方法</p>
<h4 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h4><p><a class="link" href="https://github.com/Longfu2012/UnityTest.git">Android Demo 源码地址<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link" href="https://github.com/Longfu2012/Unity3dDemo.git">Unity3d Demo 源码地址<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>Unity</category>
      </categories>
      <tags>
        <tag>Unity</tag>
      </tags>
  </entry>
  <entry>
    <title>APK改之理的反编译MSA移动安全联盟sdk异常问题</title>
    <url>/2021/04/30/APK%E6%94%B9%E4%B9%8B%E7%90%86%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91MSA%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E8%81%94%E7%9B%9Fsdk%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h4 id="一、起因"><a href="#一、起因" class="headerlink" title="一、起因"></a>一、起因</h4><p>接到运营的需求，需要对CP的包体进行部分修正，默默的掏出APK改之理搞起来，一顿进程后，发现好家伙，失败了？？<br><img src="/2021/04/30/APK%E6%94%B9%E4%B9%8B%E7%90%86%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91MSA%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E8%81%94%E7%9B%9Fsdk%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/1.png" alt="演示1"><br>这就尴尬了，赶紧看看什么原因。。。点开目录一看，好家伙，怎么出现了smali_assets目录.<br><img src="/2021/04/30/APK%E6%94%B9%E4%B9%8B%E7%90%86%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91MSA%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E8%81%94%E7%9B%9Fsdk%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/2.png" alt="演示2"></p>
<h4 id="二、查因"><a href="#二、查因" class="headerlink" title="二、查因"></a>二、查因</h4><p>顺着assets关键字对apk进行解压缩，发现apk包里面的assets目录先存着一个dex文件，如图所示<br><img src="/2021/04/30/APK%E6%94%B9%E4%B9%8B%E7%90%86%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91MSA%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E8%81%94%E7%9B%9Fsdk%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/3.png" alt="演示3"><br>那么问题就是出现在了这里咯？<br>这个Dex文件是从哪里来的呢？查询得知它来自<a class="link" href="http://www.msa-alliance.cn/col.jsp?id=120">MSA移动安全联盟sdk<i class="fas fa-external-link-alt"></i></a>，这个SDK是为了解决，Android 10版本中，广告渠道商们作为非厂商系统应用将无法获取 IMEI、MAC等设备信息选择OAID字段作为IMEI等的替代字段标识.没错，它是为了获取设备标识来获取OAID字段的。也就是未来很多apk将会带上这个SDK，那这个问题得解决啊.</p>
<h4 id="三、解决"><a href="#三、解决" class="headerlink" title="三、解决"></a>三、解决</h4><p>这个问题其实是APK改之理没有长期更新遗留的一个问题，这个问题可以通过两种方法解决。</p>
<h6 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h6><p>既然APK改之理不支持assets目录有dex文件存在来操作，那么只要把apk里面的assets的dex文件拿出来，反编译，回编译的时候手动放回去就可以解决，这个解决方式一两次还好，多次就显得麻烦的要死了，而且回编译的时候很可能会忘记，导致apk的一些功能异常。</p>
<h6 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h6><p>解决问题肯定要找到根源来解决啦，APK改之理虽然不更新了，但是他也是依托apktool这个工具来反编译了，说白了就是代码调用了一下这个工具而已，那么更新一下apktool不就可以了，还好apktool到现在没有断更。<br>找到自己现在用的apktool的目录，通过修改apktool来到达彻底解决这个问题的目的。<br><img src="/2021/04/30/APK%E6%94%B9%E4%B9%8B%E7%90%86%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91MSA%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E8%81%94%E7%9B%9Fsdk%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/7.png" alt="演示7"><br><img src="/2021/04/30/APK%E6%94%B9%E4%B9%8B%E7%90%86%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91MSA%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E8%81%94%E7%9B%9Fsdk%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/8.png" alt="演示8"><br>找到apktool是官网更新日志，查看解决方法，发现在版本2.4.1以上就已经解决了这个问题。<br><img src="/2021/04/30/APK%E6%94%B9%E4%B9%8B%E7%90%86%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91MSA%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E8%81%94%E7%9B%9Fsdk%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/4.png" alt="演示4"><br><a class="link" href="https://ibotpeaches.github.io/Apktool/changes/">APKTool官网更新日志<i class="fas fa-external-link-alt"></i></a><br>既然知道了解决办法，其实就是加一条指令 <code>--only-main-classes</code> 而已。那问题就不大了，找打apktool的源代码，<a class="link" href="https://github.com/iBotPeaches/Apktool">Apktool在github的源码地址<i class="fas fa-external-link-alt"></i></a>，翻到程序的入口类 <code>brut.apktool.Main</code> 找到对应的入口main方法后。<br>因为我们是为了给APK改之理解决这个问题了，所以就偷个懒，不用看apktool的源代码了，直接遇到反编译指令的时候，强行插入一段我们想要插入的指令，如下<br><img src="/2021/04/30/APK%E6%94%B9%E4%B9%8B%E7%90%86%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91MSA%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E8%81%94%E7%9B%9Fsdk%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/5.png" alt="演示5"><br>代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> size = args.length;</span><br><span class="line">String[] newArgs = <span class="keyword">new</span> String[size+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">boolean</span> needAdd = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; size ; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(args[i].equalsIgnoreCase(<span class="string">&quot;d&quot;</span>) || args[i].equalsIgnoreCase(<span class="string">&quot;decode&quot;</span>))&#123;</span><br><span class="line">        needAdd = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(needAdd)&#123;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; size ; i++,j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(args[i].equalsIgnoreCase(<span class="string">&quot;d&quot;</span>) || args[i].equalsIgnoreCase(<span class="string">&quot;decode&quot;</span>))&#123;</span><br><span class="line">            newArgs[j] = args[i];</span><br><span class="line">            newArgs[++j] = <span class="string">&quot;--only-main-classes&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            newArgs[j] = args[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过简单粗暴的一段代码后，不掉头发的前提下，打出了一个jar包替换APK改之理的jar解决这个问题，如下<br><img src="/2021/04/30/APK%E6%94%B9%E4%B9%8B%E7%90%86%E7%9A%84%E5%8F%8D%E7%BC%96%E8%AF%91MSA%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8%E8%81%94%E7%9B%9Fsdk%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98/6.png" alt="演示6"></p>
]]></content>
      <categories>
        <category>逆向</category>
      </categories>
      <tags>
        <tag>逆向</tag>
      </tags>
  </entry>
</search>
